<div class="page-layout">
  <div class="left-column">
    <div class="header">
      <div class="today-date">
        <%= Date.current.strftime("%-m.%-d(%a)") %>
      </div>
      <div class="random-message">
        <%= @random_message %>
      </div>
    </div>

    <div class="task-list-wrapper">
      <h3>TO DO</h3>
      <div class="task-list">
        <% @in_progress_tasks.each do |task| %>
          <div class="task-card" style="border-left: 8px solid <%= task.color_code %>;">
            <h4><%= task.title %></h4>
            <p>カテゴリ: <%= task.category %></p>
            <p>期間: <%= task.start_date&.to_date %> ～ <%= task.end_date&.to_date %></p>
            <p>進捗: <%= task.completion_rate %>％</p>
            <div class="actions">
              <%= link_to '表示', task_path(task) %> |
              <%= link_to '編集', edit_task_path(task) %> |
              <%= link_to '削除', task_path(task), method: :delete, data: { confirm: '本当に削除しますか？' } %>
            </div>
          </div>
        <% end %>
        <%= link_to '新規作成', new_task_path %>
      </div>

      <h3>完了したタスク</h3>
      <div class="task-list">
        <% @completed_tasks.each do |task| %>
          <div class="task-card" style="border-left: 8px solid <%= task.color_code %>;">
            <h4><%= task.title %></h4>
            <p>カテゴリ: <%= task.category %></p>
            <p>期間: <%= task.start_date&.to_date %> ～ <%= task.end_date&.to_date %></p>
            <p>進捗: <%= task.completion_rate %>％</p>
            <div class="actions">
              <%= link_to '表示', task_path(task) %> |
              <%= link_to '編集', edit_task_path(task) %> |
              <%= link_to '削除', task_path(task), method: :delete, data: { confirm: '本当に削除しますか？' } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="right-column">
    <div class="calendar-wrapper">
      <h3>CALENDAR</h3>
      <div class="calender-container">
        <table class="calendar">
          <thead>
            <tr>
              <th>日</th>
              <th>月</th>
              <th>火</th>
              <th>水</th>
              <th>木</th>
              <th>金</th>
              <th>土</th>
            </tr>
          </thead>
          <tbody>
          <% @current_month_dates.each_slice(7) do |week| %>
            <tr>
              <% week.each do |date| %>
                <td class="<%= 'checked' if @tasks.any? { |task| task.task_logs.exists?(executed_on: date) } %>">
                  <div class="task-background">
                    <% tasks_on_date = @tasks.select { |task| task.task_logs.exists?(executed_on: date) } %>
                    <% tasks_on_date.each_with_index do |task, index| %>
                      <span class="task-span" style="background-color: <%= task.color_code %>; width: <%= 100 / tasks_on_date.size %>%;"></span>
                    <% end %>
                  </div>
                  <div class="date-number">
                    <strong><%= date.day %></strong>
                  </div>
                </td>
              <% end %>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="graph-wrapper">
      <h3>GRAPH</h3>
      <div class="graph-container">
        <%= column_chart(
              @progress_data.map { |date, progress| [date.strftime("%Y-%m-%d"), progress] },
              height: "300px",
              ytitle: "進捗率 (%)",
              stacked: true
            )
        %>
      </div>
    </div>
  </div>
</div>
