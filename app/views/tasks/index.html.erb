<h1>タスク一覧</h1>

<%= link_to '新規作成', new_task_path %>

<table>
  <thead>
    <tr>
      <th>タイトル</th>
      <th>色</th>
      <th>カテゴリ</th>
      <th>期間</th>
      <th>進捗</th>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= task.title %></td>
        <td style="background-color: <%= task.color_code %>;">
          <%= task.color %>
        </td>
        <td><%= task.category %></td>
        <td><%= task.start_date&.to_date %> ～ <%= task.end_date&.to_date %></td>
        <td><%= task.progress_percentage %><td>
          <%= link_to '表示', task_path(task) %> |
          <%= link_to '編集', edit_task_path(task) %> |
          <%= link_to '削除', task_path(task), method: :delete, data: { confirm: '本当に削除しますか？' } %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<h1>今月のカレンダー</h1>

<table class="calendar">
  <thead>
    <tr>
      <th>日</th>
      <th>月</th>
      <th>火</th>
      <th>水</th>
      <th>木</th>
      <th>金</th>
      <th>土</th>
    </tr>
  </thead>
  <tbody>
  <% @dates_in_month.each_slice(7) do |week| %>
    <tr>
      <% week.each do |date| %>
        <td class="<%= 'checked' if @tasks.any? { |task| task.task_logs.exists?(executed_on: date) } %>">
          <%= date.day %>
          <% @tasks.each do |task| %>
            <% if task.task_logs.exists?(executed_on: date) %>
              <span class="circle-indicator" style="background-color: <%= task.color_code %>;">⚪︎</span> <!-- チェックされた日に丸印を表示 -->
            <% end %>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</tbody>
</table>
